# COMANDOS PARA DIGITAR UM POR VEZ NO TERMINAL DA LOCAWEB
# Copie e cole cada linha individualmente

# 1. Parar servidor atual
pkill -f "python manage.py runserver"

# 2. Instalar gunicorn
pip install gunicorn

# 3. Criar arquivo nginx
sudo nano /etc/nginx/sites-available/sistema-estelar

# 4. Cole este conteúdo no arquivo (copie tudo de uma vez):
server {
    listen 80;
    server_name _;
    
    location /static/ {
        alias /var/www/sistema-estelar/staticfiles/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    location /media/ {
        alias /var/www/sistema-estelar/media/;
        expires 1y;
        add_header Cache-Control "public";
    }
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_redirect off;
    }
    
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
}

# 5. Salvar arquivo (Ctrl+X, Y, Enter)

# 6. Ativar site
sudo ln -s /etc/nginx/sites-available/sistema-estelar /etc/nginx/sites-enabled/

# 7. Remover site padrão
sudo rm /etc/nginx/sites-enabled/default

# 8. Testar nginx
sudo nginx -t

# 9. Reiniciar nginx
sudo systemctl restart nginx

# 10. Configurar permissões
sudo chown -R www-data:www-data /var/www/sistema-estelar

# 11. Coletar arquivos estáticos
python manage.py collectstatic --noinput --settings=sistema_estelar.settings_production

# 12. Executar migrações
python manage.py migrate --settings=sistema_estelar.settings_production

# 13. Iniciar gunicorn
gunicorn --config gunicorn.conf.py sistema_estelar.wsgi_production:application

# 14. Testar (em outro terminal)
curl http://localhost:8000
curl http://localhost
