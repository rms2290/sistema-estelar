{% extends 'base.html' %}

{% block title %}Adicionar Motorista{% endblock %} {# Ou Editar Motorista #}

{% block content %}
<div class="container mt-4">
    <h2><i class="fas fa-user-tie"></i> Adicionar Motorista</h2> {# Ou Editar Motorista #}

    <form method="post">
        {% csrf_token %}

        {# Erros gerais do formulário #}
        {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
        {% endif %}

        {# Seção de Dados do Motorista #}
        <div class="card card-body mb-4">
            <h3><i class="fas fa-user"></i> Dados do Motorista</h3>
            <div class="row">
                {# Renderiza os campos individualmente para controlar a ordem e a visibilidade #}
                <div class="col-md-6 mb-3">
                    <label for="{{ form.nome.id_for_label }}" class="form-label">
                        <i class="fas fa-user"></i> {{ form.nome.label }}:
                    </label>
                    {{ form.nome }}
                    {% if form.nome.errors %}<div class="text-danger">{{ form.nome.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.cpf.id_for_label }}" class="form-label">
                        <i class="fas fa-id-card"></i> {{ form.cpf.label }}:
                    </label>
                    {{ form.cpf }}
                    {% if form.cpf.errors %}<div class="text-danger">{{ form.cpf.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.rg.id_for_label }}" class="form-label">
                        <i class="fas fa-id-card"></i> {{ form.rg.label }}:
                    </label>
                    {{ form.rg }}
                    {% if form.rg.errors %}<div class="text-danger">{{ form.rg.errors }}</div>{% endif %}
                </div>
                {# ... (outros campos: cnh, codigo_seguranca, vencimento_cnh, uf_emissao_cnh, telefone) ... #}
                <div class="col-md-6 mb-3">
                    <label for="{{ form.cnh.id_for_label }}" class="form-label">
                        <i class="fas fa-id-badge"></i> {{ form.cnh.label }}:
                    </label>
                    {{ form.cnh }}
                    {% if form.cnh.errors %}<div class="text-danger">{{ form.cnh.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.codigo_seguranca.id_for_label }}" class="form-label">
                        <i class="fas fa-shield-alt"></i> {{ form.codigo_seguranca.label }}:
                    </label>
                    {{ form.codigo_seguranca }}
                    {% if form.codigo_seguranca.errors %}<div class="text-danger">{{ form.codigo_seguranca.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.vencimento_cnh.id_for_label }}" class="form-label">
                        <i class="fas fa-calendar-alt"></i> {{ form.vencimento_cnh.label }}:
                    </label>
                    {{ form.vencimento_cnh }}
                    {% if form.vencimento_cnh.errors %}<div class="text-danger">{{ form.vencimento_cnh.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.uf_emissao_cnh.id_for_label }}" class="form-label">
                        <i class="fas fa-flag"></i> {{ form.uf_emissao_cnh.label }}:
                    </label>
                    {{ form.uf_emissao_cnh }}
                    {% if form.uf_emissao_cnh.errors %}<div class="text-danger">{{ form.uf_emissao_cnh.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.telefone.id_for_label }}" class="form-label">
                        <i class="fas fa-phone"></i> {{ form.telefone.label }}:
                    </label>
                    {{ form.telefone }}
                    {% if form.telefone.errors %}<div class="text-danger">{{ form.telefone.errors }}</div>{% endif %}
                </div>

                <div class="col-12 mt-3 mb-2"><h4><i class="fas fa-map-marker-alt"></i> Endereço</h4></div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.endereco.id_for_label }}" class="form-label">
                        <i class="fas fa-map"></i> {{ form.endereco.label }}:
                    </label>
                    {{ form.endereco }}
                    {% if form.endereco.errors %}<div class="text-danger">{{ form.endereco.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.numero.id_for_label }}" class="form-label">
                        <i class="fas fa-hashtag"></i> {{ form.numero.label }}:
                    </label>
                    {{ form.numero }}
                    {% if form.numero.errors %}<div class="text-danger">{{ form.numero.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.bairro.id_for_label }}" class="form-label">
                        <i class="fas fa-map-pin"></i> {{ form.bairro.label }}:
                    </label>
                    {{ form.bairro }}
                    {% if form.bairro.errors %}<div class="text-danger">{{ form.bairro.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.cidade.id_for_label }}" class="form-label">
                        <i class="fas fa-city"></i> {{ form.cidade.label }}:
                    </label>
                    {{ form.cidade }}
                    {% if form.cidade.errors %}<div class="text-danger">{{ form.cidade.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.estado.id_for_label }}" class="form-label">
                        <i class="fas fa-flag"></i> {{ form.estado.label }}:
                    </label>
                    {{ form.estado }}
                    {% if form.estado.errors %}<div class="text-danger">{{ form.estado.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.cep.id_for_label }}" class="form-label">
                        <i class="fas fa-mail-bulk"></i> {{ form.cep.label }}:
                    </label>
                    {{ form.cep }}
                    {% if form.cep.errors %}<div class="text-danger">{{ form.cep.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.data_nascimento.id_for_label }}" class="form-label">
                        <i class="fas fa-birthday-cake"></i> {{ form.data_nascimento.label }}:
                    </label>
                    {{ form.data_nascimento }}
                    {% if form.data_nascimento.errors %}<div class="text-danger">{{ form.data_nascimento.errors }}</div>{% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.numero_consulta.id_for_label }}" class="form-label">
                        <i class="fas fa-search"></i> {{ form.numero_consulta.label }}:
                    </label>
                    {{ form.numero_consulta }}
                    {% if form.numero_consulta.errors %}<div class="text-danger">{{ form.numero_consulta.errors }}</div>{% endif %}
                </div>
                
                {# Histórico de consultas (apenas na edição) #}
                {% if historico_consultas %}
                <div class="col-12 mt-3 mb-2">
                    <h4><i class="fas fa-history"></i> Histórico das Últimas 5 Consultas</h4>
                    <div class="table-responsive">
                        <table class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Número</th>
                                    <th>Gerenciadora</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for consulta in historico_consultas %}
                                    <tr>
                                        <td>{{ consulta.data_consulta|date:"d/m/Y" }}</td>
                                        <td><strong>{{ consulta.numero_consulta }}</strong></td>
                                        <td>{{ consulta.gerenciadora|default:"-" }}</td>
                                        <td>
                                            {% if consulta.status_consulta == 'Apto' %}
                                                <span class="badge bg-ativo">{{ consulta.status_consulta }}</span>
                                            {% elif consulta.status_consulta == 'Inapto' %}
                                                <span class="badge bg-inativo">{{ consulta.status_consulta }}</span>
                                            {% else %}
                                                <span class="badge bg-warning">{{ consulta.status_consulta }}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
            </div>


        </div> {# Fim do card-body de Dados do Motorista #}

        {# Campo de Observações #}
        <div class="card card-body mb-4">
            <h3><i class="fas fa-sticky-note"></i> Observações</h3>
            <div class="row">
                <div class="col-12 mb-3">
                    <label for="{{ form.observacoes.id_for_label }}" class="form-label">
                        <i class="fas fa-comment"></i> {{ form.observacoes.label }}:
                    </label>
                    {{ form.observacoes }}
                    {% if form.observacoes.errors %}<div class="text-danger">{{ form.observacoes.errors }}</div>{% endif %}
                    <div class="form-text">Informações adicionais sobre o motorista (opcional).</div>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-success mt-3">Salvar</button>
        <a href="{% url 'notas:listar_motoristas' %}" class="btn btn-secondary mt-3">Cancelar</a>
    </form>

</div>
{% endblock %}